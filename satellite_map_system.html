<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¡›æ˜Ÿãƒ‡ãƒ¼ã‚¿åœ°å›³ã‚·ã‚¹ãƒ†ãƒ </title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Meiryo', sans-serif;
      background: #1a1a1a;
      overflow: hidden;
    }
    
    #container {
      position: relative;
      width: 100vw;
      height: 100vh;
    }
    
    #map {
      width: 100%;
      height: 100%;
      z-index: 1;
    }
    
    #control-panel {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 20px;
      border-radius: 15px;
      border: 2px solid #4CAF50;
      backdrop-filter: blur(10px);
      z-index: 1000;
      min-width: 300px;
    }
    
    .control-section {
      margin-bottom: 20px;
    }
    
    .control-section h3 {
      margin: 0 0 10px 0;
      color: #4CAF50;
      font-size: 16px;
    }
    
    .map-type-selector {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .map-button {
      background: linear-gradient(45deg, #2196F3, #1976D2);
      color: white;
      border: none;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.3s;
    }
    
    .map-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(33, 150, 243, 0.4);
    }
    
    .map-button.active {
      background: linear-gradient(45deg, #4CAF50, #45a049);
    }
    
    .location-selector {
      margin-bottom: 15px;
    }
    
    .location-button {
      background: linear-gradient(45deg, #FF9800, #F57C00);
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      margin: 2px;
      font-size: 11px;
      transition: all 0.3s;
    }
    
    .location-button:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 10px rgba(255, 152, 0, 0.4);
    }
    
    .data-layer-controls {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .layer-toggle {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .layer-toggle input[type="checkbox"] {
      width: 16px;
      height: 16px;
      accent-color: #4CAF50;
    }
    
    .layer-toggle label {
      font-size: 12px;
      cursor: pointer;
    }
    
    #info-panel {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 20px;
      border-radius: 15px;
      border: 2px solid #9C27B0;
      backdrop-filter: blur(10px);
      z-index: 1000;
      max-width: 350px;
    }
    
    .info-section {
      margin-bottom: 15px;
    }
    
    .info-section h4 {
      margin: 0 0 8px 0;
      color: #9C27B0;
      font-size: 14px;
    }
    
    .info-value {
      font-size: 18px;
      font-weight: bold;
      color: #4CAF50;
    }
    
    .info-label {
      font-size: 11px;
      color: #ccc;
      margin-bottom: 5px;
    }
    
    #search-panel {
      position: absolute;
      bottom: 20px;
      left: 20px;
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 20px;
      border-radius: 15px;
      border: 2px solid #E91E63;
      backdrop-filter: blur(10px);
      z-index: 1000;
      min-width: 300px;
    }
    
    .search-input {
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      margin-bottom: 10px;
    }
    
    .search-input::placeholder {
      color: #ccc;
    }
    
    .search-button {
      background: linear-gradient(45deg, #E91E63, #C2185B);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s;
    }
    
    .search-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(233, 30, 99, 0.4);
    }
    
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(76, 175, 80, 0.9);
      color: white;
      padding: 15px 20px;
      border-radius: 10px;
      z-index: 2000;
      transform: translateX(400px);
      transition: transform 0.3s;
    }
    
    .notification.show {
      transform: translateX(0);
    }
    
    .notification.error {
      background: rgba(244, 67, 54, 0.9);
    }
    
    .notification.warning {
      background: rgba(255, 152, 0, 0.9);
    }
    
    #loading-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      color: white;
      font-size: 18px;
    }
    
    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top: 4px solid #4CAF50;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin-right: 15px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="map"></div>
    
    <!-- åˆ¶å¾¡ãƒ‘ãƒãƒ« -->
    <div id="control-panel">
      <div class="control-section">
        <h3>ğŸ—ºï¸ åœ°å›³ã‚¿ã‚¤ãƒ—</h3>
        <div class="map-type-selector">
          <button class="map-button active" onclick="changeMapType('satellite')">è¡›æ˜Ÿç”»åƒ</button>
          <button class="map-button" onclick="changeMapType('street')">ã‚¹ãƒˆãƒªãƒ¼ãƒˆ</button>
          <button class="map-button" onclick="changeMapType('terrain')">åœ°å½¢</button>
          <button class="map-button" onclick="changeMapType('hybrid')">ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰</button>
        </div>
      </div>
      
      <div class="control-section">
        <h3>ğŸ“ åœ°åŸŸé¸æŠ</h3>
        <div class="location-selector">
          <button class="location-button" onclick="goToLocation('saga')">ä½è³€çœŒ</button>
          <button class="location-button" onclick="goToLocation('nagasaki')">é•·å´çœŒ</button>
          <button class="location-button" onclick="goToLocation('takeo')">æ­¦é›„å¸‚</button>
          <button class="location-button" onclick="goToLocation('fukuoka')">ç¦å²¡çœŒ</button>
        </div>
      </div>
      
      <div class="control-section">
        <h3>ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ãƒ¤ãƒ¼</h3>
        <div class="data-layer-controls">
          <div class="layer-toggle">
            <input type="checkbox" id="buildings" checked>
            <label for="buildings">å»ºç‰©ãƒ‡ãƒ¼ã‚¿</label>
          </div>
          <div class="layer-toggle">
            <input type="checkbox" id="roads" checked>
            <label for="roads">é“è·¯ãƒ‡ãƒ¼ã‚¿</label>
          </div>
          <div class="layer-toggle">
            <input type="checkbox" id="water" checked>
            <label for="water">æ°´åŸŸãƒ‡ãƒ¼ã‚¿</label>
          </div>
          <div class="layer-toggle">
            <input type="checkbox" id="landuse">
            <label for="landuse">åœŸåœ°åˆ©ç”¨</label>
          </div>
        </div>
      </div>
    </div>
    
    <!-- æƒ…å ±ãƒ‘ãƒãƒ« -->
    <div id="info-panel">
      <div class="info-section">
        <h4>ğŸ“ ç¾åœ¨ä½ç½®</h4>
        <div class="info-label">ç·¯åº¦</div>
        <div class="info-value" id="latitude">33.2494</div>
        <div class="info-label">çµŒåº¦</div>
        <div class="info-value" id="longitude">130.2988</div>
      </div>
      
      <div class="info-section">
        <h4>ğŸ—ºï¸ åœ°å›³æƒ…å ±</h4>
        <div class="info-label">ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«</div>
        <div class="info-value" id="zoom-level">12</div>
        <div class="info-label">åœ°å›³ã‚¿ã‚¤ãƒ—</div>
        <div class="info-value" id="map-type">è¡›æ˜Ÿç”»åƒ</div>
      </div>
      
      <div class="info-section">
        <h4>ğŸ“¡ è¡›æ˜Ÿãƒ‡ãƒ¼ã‚¿</h4>
        <div class="info-label">è§£åƒåº¦</div>
        <div class="info-value">é«˜è§£åƒåº¦</div>
        <div class="info-label">æ›´æ–°æ—¥</div>
        <div class="info-value">æœ€æ–°</div>
      </div>
    </div>
    
    <!-- æ¤œç´¢ãƒ‘ãƒãƒ« -->
    <div id="search-panel">
      <h3>ğŸ” å ´æ‰€æ¤œç´¢</h3>
      <input type="text" class="search-input" id="search-input" placeholder="å ´æ‰€åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„...">
      <button class="search-button" onclick="searchLocation()">æ¤œç´¢</button>
      
      <div style="margin-top: 15px;">
        <h4>ğŸ’¡ æ¤œç´¢ä¾‹</h4>
        <div style="font-size: 12px; color: #ccc;">
          â€¢ æ–°æ­¦é›„ç—…é™¢<br>
          â€¢ ä½è³€é§…<br>
          â€¢ é•·å´æ¸¯<br>
          â€¢ å¤ªå®°åºœå¤©æº€å®®
        </div>
      </div>
    </div>
    
    <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
    <div id="loading-overlay">
      <div class="spinner"></div>
      <span>åœ°å›³ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</span>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    let map;
    let currentMapType = 'satellite';
    let layers = {
      buildings: null,
      roads: null,
      water: null,
      landuse: null
    };
    
    // åœ°å›³ã‚¿ã‚¤ãƒ—å®šç¾©
    const mapTypes = {
      satellite: {
        url: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      },
      street: {
        url: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      },
      terrain: {
        url: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      },
      hybrid: {
        url: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      }
    };
    
    // åœ°åŸŸåº§æ¨™å®šç¾©
    const locations = {
      saga: { lat: 33.2494, lng: 130.2988, name: 'ä½è³€çœŒ' },
      nagasaki: { lat: 32.7504, lng: 129.8675, name: 'é•·å´çœŒ' },
      takeo: { lat: 33.1894, lng: 130.0208, name: 'æ­¦é›„å¸‚' },
      fukuoka: { lat: 33.5902, lng: 130.4017, name: 'ç¦å²¡çœŒ' }
    };
    
    // åˆæœŸåŒ–
    function init() {
      // èª­ã¿è¾¼ã¿é–‹å§‹é€šçŸ¥
      showNotification('åœ°å›³ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã‚’é–‹å§‹ã—ã¾ã—ãŸ', 'success');
      
      // åœ°å›³ä½œæˆ
      map = L.map('map', {
        center: [33.2494, 130.2988], // ä½è³€çœŒä¸­å¿ƒ
        zoom: 12,
        zoomControl: true,
        attributionControl: true,
        preferCanvas: true, // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š
        updateWhenIdle: true, // ã‚¢ã‚¤ãƒ‰ãƒ«æ™‚ã«æ›´æ–°
        updateWhenZooming: false, // ã‚ºãƒ¼ãƒ ä¸­ã®æ›´æ–°ã‚’ç„¡åŠ¹åŒ–
        fadeAnimation: false, // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç„¡åŠ¹åŒ–ã§é«˜é€ŸåŒ–
        zoomAnimation: false // ã‚ºãƒ¼ãƒ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç„¡åŠ¹åŒ–
      });
      
      // åˆæœŸåœ°å›³ãƒ¬ã‚¤ãƒ¤ãƒ¼è¿½åŠ 
      addMapLayer(currentMapType);
      
      // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
      map.on('moveend', updateInfo);
      map.on('zoomend', updateInfo);
      map.on('load', onMapLoad);
      map.on('tileloadstart', onTileLoadStart);
      map.on('tileload', onTileLoad);
      map.on('tileerror', onTileError);
      
      // åˆæœŸæƒ…å ±æ›´æ–°
      updateInfo();
      
      // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°éè¡¨ç¤ºï¼ˆæ™‚é–“çŸ­ç¸®ï¼‰
      setTimeout(() => {
        document.getElementById('loading-overlay').style.display = 'none';
        showNotification('åœ°å›³ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');
      }, 800); // ã•ã‚‰ã«çŸ­ç¸®
      
      // ã‚µãƒ³ãƒ—ãƒ«ãƒãƒ¼ã‚«ãƒ¼è¿½åŠ 
      addSampleMarkers();
      
      // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–
      startPerformanceMonitoring();
    }
    
    // åœ°å›³èª­ã¿è¾¼ã¿å®Œäº†
    function onMapLoad() {
      console.log('åœ°å›³ã®åˆæœŸèª­ã¿è¾¼ã¿ãŒå®Œäº†ã—ã¾ã—ãŸ');
      showNotification('åœ°å›³ã®åˆæœŸåŒ–ãŒå®Œäº†ã—ã¾ã—ãŸ', 'success');
    }
    
    // ã‚¿ã‚¤ãƒ«èª­ã¿è¾¼ã¿é–‹å§‹
    function onTileLoadStart() {
      console.log('ã‚¿ã‚¤ãƒ«èª­ã¿è¾¼ã¿é–‹å§‹');
      updateLoadingProgress(0, 'ã‚¿ã‚¤ãƒ«èª­ã¿è¾¼ã¿é–‹å§‹...');
    }
    
    // ã‚¿ã‚¤ãƒ«èª­ã¿è¾¼ã¿å®Œäº†
    function onTileLoad() {
      console.log('ã‚¿ã‚¤ãƒ«èª­ã¿è¾¼ã¿å®Œäº†');
    }
    
    // ã‚¿ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼
    function onTileError(e) {
      console.error('ã‚¿ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', e);
      showNotification('åœ°å›³ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚å†è©¦è¡Œä¸­...', 'error');
      
      // è‡ªå‹•å†è©¦è¡Œ
      setTimeout(() => {
        addMapLayer(currentMapType);
      }, 2000);
    }
    
    // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–
    function startPerformanceMonitoring() {
      let loadCount = 0;
      let errorCount = 0;
      let startTime = Date.now();
      
      map.on('tileload', () => {
        loadCount++;
        const elapsed = Date.now() - startTime;
        updateLoadingProgress(loadCount, `ã‚¿ã‚¤ãƒ«èª­ã¿è¾¼ã¿ä¸­... (${loadCount}æš)`);
        
        // èª­ã¿è¾¼ã¿é€Ÿåº¦ã®ç›£è¦–
        if (loadCount % 5 === 0) {
          const speed = (loadCount / (elapsed / 1000)).toFixed(1);
          console.log(`èª­ã¿è¾¼ã¿é€Ÿåº¦: ${speed} ã‚¿ã‚¤ãƒ«/ç§’`);
        }
      });
      
      map.on('tileerror', () => {
        errorCount++;
        if (errorCount > 5) {
          showNotification('ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„', 'warning');
        }
      });
      
      // å…¨ä½“ã®èª­ã¿è¾¼ã¿å®Œäº†ã‚’æ¤œå‡º
      setTimeout(() => {
        if (loadCount > 0) {
          const totalTime = (Date.now() - startTime) / 1000;
          console.log(`ç·èª­ã¿è¾¼ã¿æ™‚é–“: ${totalTime.toFixed(1)}ç§’, ç·ã‚¿ã‚¤ãƒ«æ•°: ${loadCount}`);
          showNotification(`èª­ã¿è¾¼ã¿å®Œäº†: ${loadCount}æšã®ã‚¿ã‚¤ãƒ«ã‚’${totalTime.toFixed(1)}ç§’ã§èª­ã¿è¾¼ã¿ã¾ã—ãŸ`, 'success');
        }
      }, 5000);
    }
    
    // èª­ã¿è¾¼ã¿é€²æ—æ›´æ–°ï¼ˆæ”¹å–„ç‰ˆï¼‰
    function updateLoadingProgress(count, message = '') {
      const progress = Math.min(100, (count / 20) * 100);
      const loadingText = document.querySelector('#loading-overlay span');
      if (loadingText) {
        const progressText = message || `åœ°å›³ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­... ${Math.round(progress)}%`;
        loadingText.textContent = progressText;
        
        // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®è¦–è¦šçš„æ›´æ–°
        const spinner = document.querySelector('.spinner');
        if (spinner) {
          spinner.style.borderTopColor = progress >= 100 ? '#4CAF50' : '#FF9800';
        }
      }
    }
    
    // åœ°å›³ãƒ¬ã‚¤ãƒ¤ãƒ¼è¿½åŠ ï¼ˆæ”¹å–„ç‰ˆï¼‰
    function addMapLayer(type) {
      if (map.hasLayer(map._baseLayer)) {
        map.removeLayer(map._baseLayer);
      }
      
      const mapConfig = mapTypes[type];
      map._baseLayer = L.tileLayer(mapConfig.url, {
        attribution: mapConfig.attribution,
        maxZoom: 19,
        minZoom: 3,
        tileSize: 256,
        updateWhenIdle: true,
        updateWhenZooming: false,
        keepBuffer: 2,
        maxNativeZoom: 18,
        crossOrigin: true, // CORSå¯¾å¿œ
        timeout: 5000 // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆçŸ­ç¸®
      });
      
      map.addLayer(map._baseLayer);
      currentMapType = type;
      
      // èª­ã¿è¾¼ã¿å®Œäº†é€šçŸ¥
      map._baseLayer.on('load', () => {
        console.log(`${getMapTypeName(type)}ã®èª­ã¿è¾¼ã¿ãŒå®Œäº†ã—ã¾ã—ãŸ`);
        showNotification(`${getMapTypeName(type)}ã®èª­ã¿è¾¼ã¿ãŒå®Œäº†ã—ã¾ã—ãŸ`, 'success');
      });
      
      // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
      map._baseLayer.on('tileerror', (e) => {
        console.error(`${getMapTypeName(type)}ã®ã‚¿ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:`, e);
        showNotification(`${getMapTypeName(type)}ã®èª­ã¿è¾¼ã¿ã«å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸ`, 'error');
      });
    }
    
    // åœ°å›³ã‚¿ã‚¤ãƒ—å¤‰æ›´
    function changeMapType(type) {
      // ãƒœã‚¿ãƒ³çŠ¶æ…‹æ›´æ–°
      document.querySelectorAll('.map-button').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
      
      // åœ°å›³ãƒ¬ã‚¤ãƒ¤ãƒ¼å¤‰æ›´
      addMapLayer(type);
      updateInfo();
      
      showNotification(`${getMapTypeName(type)}ã«åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸ`, 'success');
    }
    
    // åœ°å›³ã‚¿ã‚¤ãƒ—åå–å¾—
    function getMapTypeName(type) {
      const names = {
        satellite: 'è¡›æ˜Ÿç”»åƒ',
        street: 'ã‚¹ãƒˆãƒªãƒ¼ãƒˆ',
        terrain: 'åœ°å½¢',
        hybrid: 'ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰'
      };
      return names[type] || type;
    }
    
    // åœ°åŸŸç§»å‹•
    function goToLocation(locationKey) {
      const location = locations[locationKey];
      if (location) {
        map.setView([location.lat, location.lng], 12);
        showNotification(`${location.name}ã«ç§»å‹•ã—ã¾ã—ãŸ`, 'success');
      }
    }
    
    // å ´æ‰€æ¤œç´¢
    function searchLocation() {
      const query = document.getElementById('search-input').value.trim();
      if (!query) {
        showNotification('æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'warning');
        return;
      }
      
      // ç°¡æ˜“æ¤œç´¢ï¼ˆå®Ÿéš›ã®å®Ÿè£…ã§ã¯Geocoding APIã‚’ä½¿ç”¨ï¼‰
      const searchResults = {
        'æ–°æ­¦é›„ç—…é™¢': { lat: 33.1894, lng: 130.0208 },
        'ä½è³€é§…': { lat: 33.2644, lng: 130.2975 },
        'é•·å´æ¸¯': { lat: 32.7504, lng: 129.8675 },
        'å¤ªå®°åºœå¤©æº€å®®': { lat: 33.5194, lng: 130.5347 }
      };
      
      const result = searchResults[query];
      if (result) {
        map.setView([result.lat, result.lng], 15);
        addMarker(result.lat, result.lng, query);
        showNotification(`${query}ã‚’æ¤œç´¢ã—ã¾ã—ãŸ`, 'success');
      } else {
        showNotification(`${query}ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ`, 'error');
      }
    }
    
    // ãƒãƒ¼ã‚«ãƒ¼è¿½åŠ 
    function addMarker(lat, lng, title) {
      const marker = L.marker([lat, lng])
        .addTo(map)
        .bindPopup(title);
      
      // 3ç§’å¾Œã«ãƒãƒ¼ã‚«ãƒ¼ã‚’å‰Šé™¤
      setTimeout(() => {
        map.removeLayer(marker);
      }, 3000);
    }
    
    // ã‚µãƒ³ãƒ—ãƒ«ãƒãƒ¼ã‚«ãƒ¼è¿½åŠ 
    function addSampleMarkers() {
      const sampleLocations = [
        { lat: 33.1894, lng: 130.0208, name: 'æ–°æ­¦é›„ç—…é™¢' },
        { lat: 33.2644, lng: 130.2975, name: 'ä½è³€é§…' },
        { lat: 32.7504, lng: 129.8675, name: 'é•·å´æ¸¯' }
      ];
      
      sampleLocations.forEach(location => {
        const marker = L.marker([location.lat, location.lng])
          .addTo(map)
          .bindPopup(location.name);
      });
    }
    
    // æƒ…å ±æ›´æ–°
    function updateInfo() {
      const center = map.getCenter();
      document.getElementById('latitude').textContent = center.lat.toFixed(4);
      document.getElementById('longitude').textContent = center.lng.toFixed(4);
      document.getElementById('zoom-level').textContent = map.getZoom();
      document.getElementById('map-type').textContent = getMapTypeName(currentMapType);
    }
    
    // é€šçŸ¥è¡¨ç¤º
    function showNotification(message, type = 'success') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.classList.add('show');
      }, 100);
      
      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 300);
      }, 3000);
    }
    
    // ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ¶å¾¡
    document.getElementById('buildings').addEventListener('change', function() {
      showNotification(this.checked ? 'å»ºç‰©ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º' : 'å»ºç‰©ãƒ‡ãƒ¼ã‚¿ã‚’éè¡¨ç¤º', 'success');
    });
    
    document.getElementById('roads').addEventListener('change', function() {
      showNotification(this.checked ? 'é“è·¯ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º' : 'é“è·¯ãƒ‡ãƒ¼ã‚¿ã‚’éè¡¨ç¤º', 'success');
    });
    
    document.getElementById('water').addEventListener('change', function() {
      showNotification(this.checked ? 'æ°´åŸŸãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º' : 'æ°´åŸŸãƒ‡ãƒ¼ã‚¿ã‚’éè¡¨ç¤º', 'success');
    });
    
    document.getElementById('landuse').addEventListener('change', function() {
      showNotification(this.checked ? 'åœŸåœ°åˆ©ç”¨ã‚’è¡¨ç¤º' : 'åœŸåœ°åˆ©ç”¨ã‚’éè¡¨ç¤º', 'success');
    });
    
    // æ¤œç´¢å…¥åŠ›ã‚¨ãƒ³ã‚¿ãƒ¼ã‚­ãƒ¼å¯¾å¿œ
    document.getElementById('search-input').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        searchLocation();
      }
    });
    
    // åˆæœŸåŒ–
    window.addEventListener('load', init);
  </script>
</body>
</html> 