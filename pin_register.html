<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PINç™»éŒ²</title>
    <style>
        body {
            font-family: 'Segoe UI', 'Meiryo', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .header h1 {
            color: #2574c7;
            margin-bottom: 0.5rem;
        }
        
        .header p {
            color: #666;
            margin: 0;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: #333;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #2574c7;
        }
        
        .pin-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border: 2px solid #e9ecef;
        }
        
        .pin-input {
            font-size: 1.2rem;
            letter-spacing: 0.5em;
            text-align: center;
            font-family: 'Courier New', monospace;
            -webkit-text-security: disc;
            -moz-text-security: disc;
            text-security: disc;
        }
        
        .pin-strength {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
        }
        
        .strength-weak {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .strength-medium {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .strength-strong {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #3498db;
            color: white;
            margin: 0.5rem;
            min-width: 120px;
        }
        
        .btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-success {
            background: #27ae60;
        }
        
        .btn-success:hover {
            background: #229954;
        }
        
        .status {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            text-align: center;
            font-weight: bold;
            display: none;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .back-btn {
            position: fixed;
            top: 2rem;
            left: 2rem;
            background: rgba(255,255,255,0.9);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .back-btn:hover {
            background: rgba(255,255,255,1);
            transform: scale(1.1);
        }
        
        .security-info {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            font-size: 0.9rem;
            color: #1565c0;
        }
        
        .requirements {
            font-size: 0.85rem;
            color: #666;
            margin-top: 0.5rem;
        }
        
        /* ç™»éŒ²å®Œäº†ç”»é¢ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .completion-info {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .info-item {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .access-panel {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }
        
        .access-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }
        
        .next-steps {
            background: #f3e5f5;
            border: 1px solid #e1bee7;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }
        
        .step-list {
            margin-top: 1rem;
        }
        
        .step-item {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
            padding: 0.5rem 0;
        }
        
        .step-number {
            background: #9c27b0;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 1rem;
        }
        
        .step-text {
            flex: 1;
        }
        
        .button-group {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <button class="back-btn" onclick="window.location.href='index.html'">â†</button>
    
    <div class="container">
        <div class="header">
            <h1>ğŸ” PINç™»éŒ²</h1>
            <p>ã‚»ã‚­ãƒ¥ã‚¢ãªPINèªè¨¼</p>
        </div>
        
        <div id="status" class="status"></div>
        
        <div class="security-info">
            <strong>ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–æ©Ÿèƒ½</strong><br>
            â€¢ 6æ¡ä»¥ä¸Šã®è‹±æ•°å­—æ··åˆPIN<br>
            â€¢ ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œå›æ•°åˆ¶é™<br>
            â€¢ è‡ªå‹•ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½<br>
            â€¢ ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†å¼·åŒ–
        </div>
        
        <form id="registrationForm">
            <h3>ğŸ‘¤ åˆ©ç”¨è€…æƒ…å ±</h3>
            
            <div class="form-group">
                <label for="lastName">å§“ *</label>
                <input type="text" id="lastName" required>
            </div>
            
            <div class="form-group">
                <label for="firstName">å *</label>
                <input type="text" id="firstName" required>
            </div>
            
            <div class="form-group">
                <label for="birthDate">ç”Ÿå¹´æœˆæ—¥ *</label>
                <input type="date" id="birthDate" required>
            </div>
            
            <div class="form-group">
                <label for="gender">æ€§åˆ¥ *</label>
                <select id="gender" required>
                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                    <option value="male">ç”·æ€§</option>
                    <option value="female">å¥³æ€§</option>
                    <option value="other">ãã®ä»–</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="email">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ *</label>
                <input type="email" id="email" required>
            </div>
            
            <div class="form-group">
                <label for="phone">é›»è©±ç•ªå· *</label>
                <input type="tel" id="phone" required>
            </div>
            
            <div class="form-group">
                <label for="emergencyContact">ç·Šæ€¥é€£çµ¡å…ˆ *</label>
                <input type="text" id="emergencyContact" required>
            </div>
            
            <div class="form-group">
                <label for="jobTitle">è·ç¨® *</label>
                <select id="jobTitle" required>
                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                    <option value="manager">ç®¡ç†è€…</option>
                    <option value="staff">ã‚¹ã‚¿ãƒƒãƒ•</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="medicalInfo">åŒ»ç™‚æƒ…å ±ï¼ˆä»»æ„ï¼‰</label>
                <textarea id="medicalInfo" rows="3" placeholder="ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ã€æœè–¬ä¸­ã®è–¬ã€æ—¢å¾€æ­´ãªã©"></textarea>
            </div>
            
            <div class="pin-section">
                <h3>ğŸ” ã‚»ã‚­ãƒ¥ã‚¢PINè¨­å®š</h3>
                
                <div class="form-group">
                    <label for="pin">PINã‚³ãƒ¼ãƒ‰ *</label>
                    <input type="password" id="pin" class="pin-input" 
                           placeholder="6æ¡ä»¥ä¸Šã®è‹±æ•°å­—" 
                           minlength="6" maxlength="12" required>
                    <div class="requirements">
                        è¦ä»¶: 6æ¡ä»¥ä¸Šã€è‹±æ•°å­—æ··åˆã€é€£ç¶šæ•°å­—ç¦æ­¢
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="pinConfirm">PINç¢ºèª *</label>
                    <input type="password" id="pinConfirm" class="pin-input" 
                           placeholder="PINã‚’å†å…¥åŠ›" required>
                </div>
                
                <div id="pinStrength" class="pin-strength" style="display: none;"></div>
            </div>
            
            <div style="text-align: center; margin-top: 2rem;">
                <button type="button" class="btn btn-success" onclick="registerUser()">
                    âœ… ç™»éŒ²å®Œäº†
                </button>
                <button type="button" class="btn" onclick="resetForm()">
                    ğŸ”„ ã‚„ã‚Šç›´ã—
                </button>
            </div>
        </form>
    </div>

    <script>
        // PINå¼·åº¦ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½
        function checkPinStrength(pin) {
            if (pin.length < 6) return { strength: 'weak', message: 'PINã¯6æ¡ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„' };
            
            let score = 0;
            let hasLetter = /[a-zA-Z]/.test(pin);
            let hasNumber = /\d/.test(pin);
            let hasSpecial = /[!@#$%^&*]/.test(pin);
            let isSequential = /(123|234|345|456|567|678|789|012|abc|bcd|cde|def|efg|fgh|ghi|hij|ijk|jkl|klm|lmn|mno|nop|opq|pqr|qrs|rst|stu|tuv|uvw|vwx|wxy|xyz)/i.test(pin);
            
            if (hasLetter) score += 1;
            if (hasNumber) score += 1;
            if (hasSpecial) score += 1;
            if (pin.length >= 8) score += 1;
            if (!isSequential) score += 1;
            
            if (score <= 2) return { strength: 'weak', message: 'PINã®å¼·åº¦ãŒå¼±ã„ã§ã™ã€‚è‹±æ•°å­—æ··åˆã§8æ¡ä»¥ä¸Šã‚’æ¨å¥¨' };
            if (score <= 3) return { strength: 'medium', message: 'PINã®å¼·åº¦ã¯ä¸­ç¨‹åº¦ã§ã™ã€‚ç‰¹æ®Šæ–‡å­—ã®è¿½åŠ ã‚’æ¨å¥¨' };
            return { strength: 'strong', message: 'PINã®å¼·åº¦ã¯è‰¯å¥½ã§ã™' };
        }
        
        // PINå…¥åŠ›æ™‚ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒã‚§ãƒƒã‚¯
        document.getElementById('pin').addEventListener('input', function() {
            const pin = this.value;
            const strengthDiv = document.getElementById('pinStrength');
            
            if (pin.length >= 3) {
                const result = checkPinStrength(pin);
                strengthDiv.className = `pin-strength strength-${result.strength}`;
                strengthDiv.textContent = result.message;
                strengthDiv.style.display = 'block';
            } else {
                strengthDiv.style.display = 'none';
            }
        });
        
        // ç™»éŒ²å‡¦ç†
        function registerUser() {
            const requiredFields = ['lastName', 'firstName', 'birthDate', 'gender', 'email', 'phone', 'emergencyContact', 'jobTitle', 'pin', 'pinConfirm'];
            let isValid = true;
            
            // å¿…é ˆé …ç›®ãƒã‚§ãƒƒã‚¯
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    field.style.borderColor = '#e74c3c';
                    isValid = false;
                } else {
                    field.style.borderColor = '#ddd';
                }
            });
            
            if (!isValid) {
                showStatus('å¿…é ˆé …ç›®ã‚’ã™ã¹ã¦å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚', 'error');
                return;
            }
            
            // PINå¼·åº¦ãƒã‚§ãƒƒã‚¯
            const pin = document.getElementById('pin').value;
            const pinConfirm = document.getElementById('pinConfirm').value;
            
            if (pin !== pinConfirm) {
                showStatus('PINãŒä¸€è‡´ã—ã¾ã›ã‚“ã€‚', 'error');
                document.getElementById('pinConfirm').style.borderColor = '#e74c3c';
                return;
            }
            
            const strengthResult = checkPinStrength(pin);
            if (strengthResult.strength === 'weak') {
                showStatus('PINã®å¼·åº¦ãŒå¼±ã™ãã¾ã™ã€‚ã‚ˆã‚Šå¼·åŠ›ãªPINã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚', 'error');
                return;
            }
            
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ä½œæˆ
            const userData = {
                lastName: document.getElementById('lastName').value,
                firstName: document.getElementById('firstName').value,
                birthDate: document.getElementById('birthDate').value,
                gender: document.getElementById('gender').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                emergencyContact: document.getElementById('emergencyContact').value,
                jobTitle: document.getElementById('jobTitle').value,
                medicalInfo: document.getElementById('medicalInfo').value,
                pin: pin,
                registrationDate: new Date().toISOString(),
                lastLoginAttempt: 0,
                loginAttempts: 0,
                accountLocked: false,
                lockTime: null,
                // è·ç¨®ã«å¿œã˜ãŸæ¨©é™è¨­å®š
                permissions: document.getElementById('jobTitle').value === 'manager' ? 
                    ['admin', 'user_management', 'system_settings', 'reports'] : 
                    ['basic_access', 'game_play', 'progress_view']
            };
            
            // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
            localStorage.setItem('isAuthenticated', 'true');
            localStorage.setItem('registeredUser', JSON.stringify(userData));
            localStorage.setItem('registeredPin', pin);
            localStorage.setItem('loginAttempts', '0');
            localStorage.setItem('lastLoginAttempt', Date.now().toString());
            
            console.log('ç™»éŒ²ãƒ‡ãƒ¼ã‚¿:', userData);
            
            showStatus('PINç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸï¼ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ç§»å‹•ã—ã¾ã™ã€‚', 'success');
            
            // ç™»éŒ²å®Œäº†ç”»é¢ã‚’è¡¨ç¤º
            showRegistrationComplete(userData);
        }
        
        // ç™»éŒ²å®Œäº†ç”»é¢è¡¨ç¤º
        function showRegistrationComplete(userData) {
            const container = document.querySelector('.container');
            const isManager = userData.jobTitle === 'manager';
            
            container.innerHTML = `
                <div class="header">
                    <h1>âœ… ç™»éŒ²å®Œäº†</h1>
                    <p>PINç™»éŒ²ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸ</p>
                </div>
                
                <div class="status status-success" style="display: block;">
                    <strong>${userData.lastName} ${userData.firstName} æ§˜</strong><br>
                    ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ã€‚
                </div>
                
                <div class="completion-info">
                    <h3>ğŸ“‹ ç™»éŒ²æƒ…å ±</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <strong>æ°å:</strong> ${userData.lastName} ${userData.firstName}
                        </div>
                        <div class="info-item">
                            <strong>è·ç¨®:</strong> ${userData.jobTitle === 'manager' ? 'ç®¡ç†è€…' : 'ã‚¹ã‚¿ãƒƒãƒ•'}
                        </div>
                        <div class="info-item">
                            <strong>ãƒ¡ãƒ¼ãƒ«:</strong> ${userData.email}
                        </div>
                        <div class="info-item">
                            <strong>ç™»éŒ²æ—¥:</strong> ${new Date(userData.registrationDate).toLocaleDateString('ja-JP')}
                        </div>
                    </div>
                </div>
                
                <div class="access-panel">
                    <h3>ğŸš€ ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªæ©Ÿèƒ½</h3>
                    <div class="access-buttons">
                        <button class="btn btn-success" onclick="window.location.href='index.html'">
                            ğŸ  ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸
                        </button>
                        <button class="btn btn-info" onclick="window.location.href='pin_login.html'">
                            ğŸ” PINãƒ­ã‚°ã‚¤ãƒ³
                        </button>
                        ${isManager ? `
                            <button class="btn btn-warning" onclick="window.location.href='unified_admin.html'">
                                âš™ï¸ ç®¡ç†è€…ç”»é¢
                            </button>
                        ` : `
                            <button class="btn btn-warning" onclick="window.location.href='staff_dashboard.html'">
                                ğŸ“Š ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†ç”»é¢
                            </button>
                        `}
                    </div>
                </div>
                
                <div class="next-steps">
                    <h3>ğŸ“ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—</h3>
                    <div class="step-list">
                        <div class="step-item">
                            <span class="step-number">1</span>
                            <span class="step-text">PINãƒ­ã‚°ã‚¤ãƒ³ã§ã‚·ã‚¹ãƒ†ãƒ ã«ãƒ­ã‚°ã‚¤ãƒ³</span>
                        </div>
                        <div class="step-item">
                            <span class="step-number">2</span>
                            <span class="step-text">è„³ãƒˆãƒ¬ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹</span>
                        </div>
                        <div class="step-item">
                            <span class="step-number">3</span>
                            <span class="step-text">${isManager ? 'ç®¡ç†è€…ç”»é¢ã§åˆ©ç”¨çŠ¶æ³ã‚’ç¢ºèª' : 'ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†ç”»é¢ã§åˆ©ç”¨å±¥æ­´ã‚’ç¢ºèª'}</span>
                        </div>
                    </div>
                </div>
                
                <div class="button-group" style="text-align: center; margin-top: 2rem;">
                    <button class="btn btn-success" onclick="window.location.href='index.html'">
                        ğŸ  ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã¸
                    </button>
                    ${isManager ? `
                        <button class="btn btn-warning" onclick="window.location.href='unified_admin.html'">
                            âš™ï¸ ç®¡ç†è€…ç”»é¢ã¸
                        </button>
                    ` : `
                        <button class="btn btn-warning" onclick="window.location.href='staff_dashboard.html'">
                            ğŸ“Š ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†ç”»é¢ã¸
                        </button>
                    `}
                </div>
            `;
        }
        
        // ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
        function resetForm() {
            if (confirm('ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                document.getElementById('registrationForm').reset();
                document.getElementById('pinStrength').style.display = 'none';
                showStatus('ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚', 'info');
            }
        }
        
        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status status-${type}`;
            statusDiv.style.display = 'block';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®å‡¦ç†
        document.addEventListener('DOMContentLoaded', function() {
            // æ—¢ã«ç™»éŒ²æ¸ˆã¿ã®å ´åˆã¯ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã¸
            if (localStorage.getItem('isAuthenticated') === 'true') {
                window.location.href = '/version2/index.html';
            }
        });
    </script>
</body>
</html> 