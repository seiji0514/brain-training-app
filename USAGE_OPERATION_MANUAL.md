# 利用履歴記録システム 運用マニュアル

## 概要
このシステムは、脳トレゲームの利用履歴を記録・管理するためのシステムです。

## 初期設定

### 1. サーバーの起動
```bash
node server.js
```

### 2. 管理者の顔認証登録
1. http://localhost:3000/face_register.html にアクセス
2. 管理者として登録（役割: 管理者）
3. 顔認証情報を登録

### 3. 利用履歴の確認
1. 管理者としてログイン
2. メインページの「利用履歴」ボタンをクリック
3. または直接 http://localhost:3000/usage_history.html にアクセス

## 日常運用

### 利用履歴の確認
- 日次: 利用統計の確認
- 週次: 詳細な利用パターンの分析
- 月次: 月次レポートの作成

### データバックアップ
- 自動バックアップ: 毎日実行
- 手動バックアップ: API経由で実行可能

### セッション管理
- 期限切れセッションの自動クリーンアップ
- 24時間でセッション期限切れ

## トラブルシューティング

### よくある問題
1. データベースエラー
   - 解決策: データベースファイルの権限確認

2. 顔認証エラー
   - 解決策: カメラ権限の確認

3. 利用履歴が記録されない
   - 解決策: ブラウザのlocalStorage容量確認

## API エンドポイント

### 利用履歴関連
- POST /api/usage/log - 利用履歴記録
- GET /api/usage/logs - 利用履歴取得
- GET /api/usage/statistics - 統計情報取得

### 管理関連
- POST /api/backup-database - データベースバックアップ
- POST /api/cleanup-sessions - セッションクリーンアップ
- GET /api/usage-stats - 利用統計取得

## セキュリティ

### アクセス制御
- 管理者のみが利用履歴を閲覧可能
- 顔認証による本人確認
- セッション管理による不正アクセス防止

### データ保護
- 個人情報の暗号化
- アクセスログの記録
- 定期的なバックアップ

## サポート

問題が発生した場合は、以下を確認してください：
1. サーバーログの確認
2. データベースの状態確認
3. ブラウザの開発者ツールでのエラー確認
