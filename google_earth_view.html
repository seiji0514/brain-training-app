<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Google Earth ストリートビューシステム</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Meiryo', sans-serif;
      background: #000;
      overflow: hidden;
    }
    
    #container {
      position: relative;
      width: 100vw;
      height: 100vh;
    }
    
    #canvas {
      display: block;
      width: 100%;
      height: 100%;
    }
    
    #control-panel {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 20px;
      border-radius: 15px;
      border: 2px solid #4285F4;
      backdrop-filter: blur(10px);
      z-index: 1000;
      min-width: 300px;
    }
    
    .control-section {
      margin-bottom: 20px;
    }
    
    .control-section h3 {
      margin: 0 0 10px 0;
      color: #4285F4;
      font-size: 16px;
    }
    
    .view-mode-selector {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .view-button {
      background: linear-gradient(45deg, #4285F4, #3367D6);
      color: white;
      border: none;
      padding: 12px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.3s;
    }
    
    .view-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(66, 133, 244, 0.4);
    }
    
    .view-button.active {
      background: linear-gradient(45deg, #34A853, #2E7D32);
    }
    
    .location-selector {
      margin-bottom: 15px;
    }
    
    .location-button {
      background: linear-gradient(45deg, #EA4335, #D32F2F);
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      margin: 2px;
      font-size: 11px;
      transition: all 0.3s;
    }
    
    .location-button:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 10px rgba(234, 67, 53, 0.4);
    }
    
    .camera-controls {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .camera-button {
      background: linear-gradient(45deg, #FBBC04, #F57C00);
      color: white;
      border: none;
      padding: 8px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 11px;
      transition: all 0.3s;
    }
    
    .camera-button:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 10px rgba(251, 188, 4, 0.4);
    }
    
    #info-panel {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 20px;
      border-radius: 15px;
      border: 2px solid #34A853;
      backdrop-filter: blur(10px);
      z-index: 1000;
      max-width: 350px;
    }
    
    .info-section {
      margin-bottom: 15px;
    }
    
    .info-section h4 {
      margin: 0 0 8px 0;
      color: #34A853;
      font-size: 14px;
    }
    
    .info-value {
      font-size: 18px;
      font-weight: bold;
      color: #4285F4;
    }
    
    .info-label {
      font-size: 11px;
      color: #ccc;
      margin-bottom: 5px;
    }
    
    #street-view-panel {
      position: absolute;
      bottom: 20px;
      left: 20px;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 20px;
      border-radius: 15px;
      border: 2px solid #EA4335;
      backdrop-filter: blur(10px);
      z-index: 1000;
      min-width: 300px;
    }
    
    .street-view-controls {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-top: 15px;
    }
    
    .street-view-button {
      background: linear-gradient(45deg, #EA4335, #D32F2F);
      color: white;
      border: none;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.3s;
    }
    
    .street-view-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(234, 67, 53, 0.4);
    }
    
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(66, 133, 244, 0.9);
      color: white;
      padding: 15px 20px;
      border-radius: 10px;
      z-index: 2000;
      transform: translateX(400px);
      transition: transform 0.3s;
    }
    
    .notification.show {
      transform: translateX(0);
    }
    
    .notification.error {
      background: rgba(234, 67, 53, 0.9);
    }
    
    .notification.warning {
      background: rgba(251, 188, 4, 0.9);
    }
    
    #loading-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      color: white;
      font-size: 18px;
    }
    
    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top: 4px solid #4285F4;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin-right: 15px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    #compass {
      position: absolute;
      top: 50%;
      right: 20px;
      transform: translateY(-50%);
      width: 60px;
      height: 60px;
      background: rgba(0, 0, 0, 0.7);
      border-radius: 50%;
      border: 2px solid #4285F4;
      z-index: 1000;
    }
    
    .compass-arrow {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 4px;
      height: 25px;
      background: #EA4335;
      transform-origin: 50% 0;
      transform: translate(-50%, -50%);
      border-radius: 2px;
    }
    
    .compass-arrow::after {
      content: '';
      position: absolute;
      top: -5px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 5px solid transparent;
      border-right: 5px solid transparent;
      border-bottom: 8px solid #EA4335;
    }
  </style>
</head>
<body>
  <div id="container">
    <canvas id="canvas"></canvas>
    
    <!-- 制御パネル -->
    <div id="control-panel">
      <div class="control-section">
        <h3>🌍 表示モード</h3>
        <div class="view-mode-selector">
          <button class="view-button active" onclick="changeViewMode('satellite')">衛星画像</button>
          <button class="view-button" onclick="changeViewMode('street')">ストリートビュー</button>
          <button class="view-button" onclick="changeViewMode('terrain')">3D地形</button>
          <button class="view-button" onclick="changeViewMode('hybrid')">ハイブリッド</button>
        </div>
      </div>
      
      <div class="control-section">
        <h3>📍 地域選択</h3>
        <div class="location-selector">
          <button class="location-button" onclick="goToLocation('takeo')">武雄市</button>
          <button class="location-button" onclick="goToLocation('saga')">佐賀県</button>
          <button class="location-button" onclick="goToLocation('nagasaki')">長崎県</button>
          <button class="location-button" onclick="goToLocation('fukuoka')">福岡県</button>
        </div>
      </div>
      
      <div class="control-section">
        <h3>📷 カメラ制御</h3>
        <div class="camera-controls">
          <button class="camera-button" onclick="resetCamera()">リセット</button>
          <button class="camera-button" onclick="toggleAutoRotate()">自動回転</button>
          <button class="camera-button" onclick="toggleWireframe()">ワイヤーフレーム</button>
          <button class="camera-button" onclick="toggleFog()">霧効果</button>
        </div>
      </div>
    </div>
    
    <!-- 情報パネル -->
    <div id="info-panel">
      <div class="info-section">
        <h4>📍 現在位置</h4>
        <div class="info-label">緯度</div>
        <div class="info-value" id="latitude">33.1894</div>
        <div class="info-label">経度</div>
        <div class="info-value" id="longitude">130.0208</div>
        <div class="info-label">高度</div>
        <div class="info-value" id="altitude">100m</div>
      </div>
      
      <div class="info-section">
        <h4>🌍 地球情報</h4>
        <div class="info-label">表示モード</div>
        <div class="info-value" id="view-mode">衛星画像</div>
        <div class="info-label">解像度</div>
        <div class="info-value">超高解像度</div>
        <div class="info-label">更新日</div>
        <div class="info-value">最新</div>
      </div>
      
      <div class="info-section">
        <h4>📡 衛星データ</h4>
        <div class="info-label">衛星</div>
        <div class="info-value">Landsat 9</div>
        <div class="info-label">センサー</div>
        <div class="info-value">OLI-2</div>
        <div class="info-label">波長</div>
        <div class="info-value">可視光・赤外線</div>
      </div>
    </div>
    
    <!-- ストリートビューパネル -->
    <div id="street-view-panel">
      <h3>🏙️ ストリートビュー</h3>
      <div class="street-view-controls">
        <button class="street-view-button" onclick="moveForward()">前進</button>
        <button class="street-view-button" onclick="moveBackward()">後退</button>
        <button class="street-view-button" onclick="turnLeft()">左転</button>
        <button class="street-view-button" onclick="turnRight()">右転</button>
      </div>
      <div style="margin-top: 10px; font-size: 12px; color: #ccc;">
        WASDキーでも操作可能
      </div>
    </div>
    
    <!-- コンパス -->
    <div id="compass">
      <div class="compass-arrow" id="compass-arrow"></div>
    </div>
    
    <!-- ローディングオーバーレイ -->
    <div id="loading-overlay">
      <div class="spinner"></div>
      <span>衛星データを抽出中...</span>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script>
    let scene, camera, renderer;
    let earth, clouds, atmosphere;
    let isAutoRotate = false;
    let isWireframe = false;
    let isFogEnabled = true;
    let currentViewMode = 'satellite';
    let currentLocation = { lat: 33.1894, lng: 130.0208, alt: 100 };
    
    // 初期化
    function init() {
      // シーン作成
      scene = new THREE.Scene();
      scene.fog = new THREE.Fog(0x87ceeb, 100, 1000);
      
      // カメラ作成
      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 2000);
      camera.position.set(0, 100, 200);
      
      // レンダラー作成
      renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('canvas'), antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.shadowMap.enabled = true;
      renderer.shadowMap.type = THREE.PCFSoftShadowMap;
      renderer.toneMapping = THREE.ACESFilmicToneMapping;
      renderer.toneMappingExposure = 1.2;
      
      // ライティング
      setupLighting();
      
      // 地球作成
      createEarth();
      
      // 大気圏作成
      createAtmosphere();
      
      // 雲作成
      createClouds();
      
      // 地形作成
      createTerrain();
      
      // アニメーションループ
      animate();
      
      // リサイズ対応
      window.addEventListener('resize', onWindowResize);
      
      // キーボード制御
      setupKeyboardControls();
      
      // ローディング非表示
      setTimeout(() => {
        document.getElementById('loading-overlay').style.display = 'none';
        showNotification('衛星データの抽出が完了しました', 'success');
      }, 2000);
    }
    
    // ライティング設定
    function setupLighting() {
      const ambientLight = new THREE.AmbientLight(0x404040, 0.4);
      scene.add(ambientLight);
      
      const directionalLight = new THREE.DirectionalLight(0xffffff, 1.0);
      directionalLight.position.set(100, 100, 100);
      directionalLight.castShadow = true;
      scene.add(directionalLight);
    }
    
    // 地球作成
    function createEarth() {
      const earthGeometry = new THREE.SphereGeometry(100, 64, 64);
      
      // 衛星画像テクスチャ（簡易版）
      const earthMaterial = new THREE.MeshLambertMaterial({ 
        color: 0x4285F4,
        transparent: true,
        opacity: 0.9
      });
      
      earth = new THREE.Mesh(earthGeometry, earthMaterial);
      earth.castShadow = true;
      earth.receiveShadow = true;
      scene.add(earth);
    }
    
    // 大気圏作成
    function createAtmosphere() {
      const atmosphereGeometry = new THREE.SphereGeometry(105, 32, 32);
      const atmosphereMaterial = new THREE.MeshBasicMaterial({ 
        color: 0x87ceeb,
        transparent: true,
        opacity: 0.1
      });
      
      atmosphere = new THREE.Mesh(atmosphereGeometry, atmosphereMaterial);
      scene.add(atmosphere);
    }
    
    // 雲作成
    function createClouds() {
      const cloudGeometry = new THREE.SphereGeometry(102, 32, 32);
      const cloudMaterial = new THREE.MeshBasicMaterial({ 
        color: 0xffffff,
        transparent: true,
        opacity: 0.3
      });
      
      clouds = new THREE.Mesh(cloudGeometry, cloudMaterial);
      scene.add(clouds);
    }
    
    // 地形作成
    function createTerrain() {
      const terrainGeometry = new THREE.PlaneGeometry(1000, 1000, 50, 50);
      const terrainMaterial = new THREE.MeshLambertMaterial({ 
        color: 0x34A853,
        wireframe: false
      });
      
      const terrain = new THREE.Mesh(terrainGeometry, terrainMaterial);
      terrain.rotation.x = -Math.PI / 2;
      terrain.position.y = -50;
      terrain.receiveShadow = true;
      scene.add(terrain);
    }
    
    // 表示モード変更
    function changeViewMode(mode) {
      // ボタン状態更新
      document.querySelectorAll('.view-button').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
      
      currentViewMode = mode;
      document.getElementById('view-mode').textContent = getViewModeName(mode);
      
      // 地球の色を変更
      const colors = {
        satellite: 0x4285F4,
        street: 0x34A853,
        terrain: 0x8B4513,
        hybrid: 0xEA4335
      };
      
      earth.material.color.setHex(colors[mode]);
      showNotification(`${getViewModeName(mode)}モードに切り替えました`, 'success');
    }
    
    // 表示モード名取得
    function getViewModeName(mode) {
      const names = {
        satellite: '衛星画像',
        street: 'ストリートビュー',
        terrain: '3D地形',
        hybrid: 'ハイブリッド'
      };
      return names[mode] || mode;
    }
    
    // 地域移動
    function goToLocation(locationKey) {
      const locations = {
        takeo: { lat: 33.1894, lng: 130.0208, name: '武雄市' },
        saga: { lat: 33.2494, lng: 130.2988, name: '佐賀県' },
        nagasaki: { lat: 32.7504, lng: 129.8675, name: '長崎県' },
        fukuoka: { lat: 33.5902, lng: 130.4017, name: '福岡県' }
      };
      
      const location = locations[locationKey];
      if (location) {
        currentLocation = location;
        updateLocationInfo();
        camera.position.set(location.lng * 2, 100, location.lat * 2);
        camera.lookAt(location.lng * 2, 0, location.lat * 2);
        showNotification(`${location.name}に移動しました`, 'success');
      }
    }
    
    // カメラリセット
    function resetCamera() {
      camera.position.set(0, 100, 200);
      camera.lookAt(0, 0, 0);
      showNotification('カメラをリセットしました', 'success');
    }
    
    // 自動回転切り替え
    function toggleAutoRotate() {
      isAutoRotate = !isAutoRotate;
      showNotification(isAutoRotate ? '自動回転を開始' : '自動回転を停止', 'success');
    }
    
    // ワイヤーフレーム切り替え
    function toggleWireframe() {
      isWireframe = !isWireframe;
      earth.material.wireframe = isWireframe;
      showNotification(isWireframe ? 'ワイヤーフレーム表示' : '通常表示', 'success');
    }
    
    // 霧効果切り替え
    function toggleFog() {
      isFogEnabled = !isFogEnabled;
      scene.fog = isFogEnabled ? new THREE.Fog(0x87ceeb, 100, 1000) : null;
      showNotification(isFogEnabled ? '霧効果を有効化' : '霧効果を無効化', 'success');
    }
    
    // ストリートビュー制御
    function moveForward() {
      camera.position.z -= 10;
      showNotification('前進しました', 'success');
    }
    
    function moveBackward() {
      camera.position.z += 10;
      showNotification('後退しました', 'success');
    }
    
    function turnLeft() {
      camera.rotation.y += 0.1;
      updateCompass();
      showNotification('左に回転しました', 'success');
    }
    
    function turnRight() {
      camera.rotation.y -= 0.1;
      updateCompass();
      showNotification('右に回転しました', 'success');
    }
    
    // キーボード制御設定
    function setupKeyboardControls() {
      document.addEventListener('keydown', (e) => {
        switch(e.key.toLowerCase()) {
          case 'w':
            moveForward();
            break;
          case 's':
            moveBackward();
            break;
          case 'a':
            turnLeft();
            break;
          case 'd':
            turnRight();
            break;
        }
      });
    }
    
    // 位置情報更新
    function updateLocationInfo() {
      document.getElementById('latitude').textContent = currentLocation.lat.toFixed(4);
      document.getElementById('longitude').textContent = currentLocation.lng.toFixed(4);
      document.getElementById('altitude').textContent = `${currentLocation.alt}m`;
    }
    
    // コンパス更新
    function updateCompass() {
      const compassArrow = document.getElementById('compass-arrow');
      const rotation = (camera.rotation.y * 180 / Math.PI) + 180;
      compassArrow.style.transform = `translate(-50%, -50%) rotate(${rotation}deg)`;
    }
    
    // 通知表示
    function showNotification(message, type = 'success') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.classList.add('show');
      }, 100);
      
      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 300);
      }, 3000);
    }
    
    // ウィンドウリサイズ対応
    function onWindowResize() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    }
    
    // アニメーションループ
    function animate() {
      requestAnimationFrame(animate);
      
      // 地球の自転
      if (isAutoRotate) {
        earth.rotation.y += 0.005;
        clouds.rotation.y += 0.003;
      }
      
      // 大気圏のアニメーション
      atmosphere.rotation.y += 0.001;
      
      // コンパス更新
      updateCompass();
      
      renderer.render(scene, camera);
    }
    
    // 初期化
    window.addEventListener('load', init);
  </script>
</body>
</html> 