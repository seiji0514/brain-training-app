<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆã‚¢ãƒ©ãƒ¼ãƒˆä¸€æ‹¬ç®¡ç†ï¼‰</title>
    <link rel="manifest" href="/manifest.json">
    <script src="js/auth_check.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', 'Meiryo', sans-serif;
            margin: 0;
            padding: 0;
            background: #f5f6fa;
        }
        
        .header {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            margin: 0;
            font-size: 1.8rem;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .logout-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
        }
        
        .card h3 {
            margin: 0 0 1rem 0;
            color: #2c3e50;
            font-size: 1.3rem;
        }
        
        .card-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .stat-item {
            text-align: center;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #e74c3c;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 0.5rem;
        }
        
        .action-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.3s;
            margin-top: 1rem;
        }
        
        .action-btn:hover {
            background: #2980b9;
        }
        
        .action-btn.danger {
            background: #e74c3c;
        }
        
        .action-btn.danger:hover {
            background: #c0392b;
        }
        
        .action-btn.success {
            background: #27ae60;
        }
        
        .action-btn.success:hover {
            background: #229954;
        }
        
        .recent-activity {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .activity-item {
            display: flex;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid #eee;
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-icon {
            font-size: 1.5rem;
            margin-right: 1rem;
        }
        
        .activity-content {
            flex: 1;
        }
        
        .activity-time {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .alert-banner {
            background: #e74c3c;
            color: white;
            padding: 1em;
            text-align: center;
            font-weight: bold;
            display: none;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1em;
        }
        
        th, td {
            border: 1px solid #eee;
            padding: 0.7em;
            text-align: center;
        }
        
        th {
            background: #3498db;
            color: white;
        }
        
        .status-unread {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .status-read {
            color: #27ae60;
        }
        
        .btn {
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 0.5em 1.2em;
            cursor: pointer;
        }
        
        .btn:disabled {
            background: #aaa;
        }
        
        @media (max-width: 700px) {
            .container {
                padding: 0.5em;
            }
            th, td {
                font-size: 0.9em;
            }
        }
        
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ‘‘ ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆã‚¢ãƒ©ãƒ¼ãƒˆä¸€æ‹¬ç®¡ç†ï¼‰</h1>
        <div class="user-info">
            <span id="userDisplay"></span>
            <button class="logout-btn" onclick="logout()">ğŸšª ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
        </div>
    </div>
    
    <div class="container">
        <div class="alert-banner" id="alertBanner"></div>
        <div class="dashboard-grid">
            <div class="card">
                <div class="card-icon">ğŸ‘¥</div>
                <h3>ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†</h3>
                <p>ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç®¡ç†ã€æ¨©é™è¨­å®šã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ­ãƒƒã‚¯è§£é™¤ã‚’è¡Œã„ã¾ã™ã€‚</p>
        <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number" id="totalUsers">0</div>
                        <div class="stat-label">ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="activeUsers">0</div>
                        <div class="stat-label">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–</div>
                    </div>
                </div>
                <button class="action-btn" onclick="manageUsers()">ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†</button>
            </div>
            
            <div class="card">
                <div class="card-icon">ğŸ“Š</div>
                <h3>åˆ©ç”¨çµ±è¨ˆ</h3>
                <p>ã‚·ã‚¹ãƒ†ãƒ ã®åˆ©ç”¨çŠ¶æ³ã€ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤çµ±è¨ˆã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æã‚’ç¢ºèªã—ã¾ã™ã€‚</p>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number" id="todaySessions">0</div>
                        <div class="stat-label">ä»Šæ—¥ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="avgSessionTime">0</div>
                        <div class="stat-label">å¹³å‡ã‚»ãƒƒã‚·ãƒ§ãƒ³æ™‚é–“</div>
                    </div>
                </div>
                <button class="action-btn success" onclick="viewReports()">ãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤º</button>
            </div>
            
            <div class="card">
                <div class="card-icon">âš™ï¸</div>
                <h3>ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</h3>
                <p>ã‚·ã‚¹ãƒ†ãƒ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è¨­å®šã‚’ç®¡ç†ã—ã¾ã™ã€‚</p>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number" id="systemStatus">æ­£å¸¸</div>
                        <div class="stat-label">ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹</div>
            </div>
                    <div class="stat-item">
                        <div class="stat-number" id="lastBackup">-</div>
                        <div class="stat-label">æœ€çµ‚ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</div>
            </div>
        </div>
                <button class="action-btn" onclick="systemSettings()">è¨­å®šå¤‰æ›´</button>
                <button class="action-btn danger" onclick="backupData()">ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</button>
            </div>
        </div>
        
        <div class="recent-activity">
            <h3>ğŸ“‹ æœ€è¿‘ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£</h3>
            <div id="activityList">
                <div class="activity-item">
                    <div class="activity-icon">ğŸ”</div>
                    <div class="activity-content">
                        <div>ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ã‚¢ã‚¯ã‚»ã‚¹</div>
                        <div class="activity-time" id="currentTime"></div>
                </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <h2>ã‚¢ãƒ©ãƒ¼ãƒˆä¸€è¦§</h2>
        <table>
            <thead>
                <tr>
                    <th>æ™‚åˆ»</th><th>ç¾å ´å</th><th>å†…å®¹</th><th>é‡è¦åº¦</th><th>çŠ¶æ…‹</th><th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody id="alertTableBody">
                <!-- ã‚¢ãƒ©ãƒ¼ãƒˆè¡ŒãŒã“ã“ã«æŒ¿å…¥ã•ã‚Œã¾ã™ -->
            </tbody>
        </table>
    </div>

    <script>
        // ç®¡ç†è€…æ¨©é™ãƒã‚§ãƒƒã‚¯
        if (!isManager()) {
            alert('ã“ã®ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯ç®¡ç†è€…æ¨©é™ãŒå¿…è¦ã§ã™ã€‚');
            window.location.href = 'index.html';
        }
        
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±è¡¨ç¤º
        function displayUserInfo() {
            const userData = localStorage.getItem('registeredUser');
            if (userData) {
                try {
                    const user = JSON.parse(userData);
                    document.getElementById('userDisplay').textContent = 
                        `ğŸ‘‘ ç®¡ç†è€… ${user.lastName} ${user.firstName}`;
                } catch (error) {
                    console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®è§£æã«å¤±æ•—:', error);
                }
            }
        }
        
        // çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã®åˆæœŸåŒ–
        function initializeStats() {
            // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ï¼ˆå®Ÿéš›ã®å®Ÿè£…ã§ã¯APIã‹ã‚‰å–å¾—ï¼‰
            document.getElementById('totalUsers').textContent = '12';
            document.getElementById('activeUsers').textContent = '8';
            document.getElementById('todaySessions').textContent = '45';
            document.getElementById('avgSessionTime').textContent = '25åˆ†';
            document.getElementById('systemStatus').textContent = 'æ­£å¸¸';
            document.getElementById('lastBackup').textContent = 'ä»Šæ—¥';
            
            // ç¾åœ¨æ™‚åˆ»è¡¨ç¤º
            document.getElementById('currentTime').textContent = 
                new Date().toLocaleString('ja-JP');
        }
        
        // ç®¡ç†è€…æ©Ÿèƒ½
        function manageUsers() {
            alert('ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†æ©Ÿèƒ½ã¯é–‹ç™ºä¸­ã§ã™');
        }
        
        function viewReports() {
            alert('ãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤ºæ©Ÿèƒ½ã¯é–‹ç™ºä¸­ã§ã™');
        }
        
        function systemSettings() {
            alert('ã‚·ã‚¹ãƒ†ãƒ è¨­å®šæ©Ÿèƒ½ã¯é–‹ç™ºä¸­ã§ã™');
        }
        
        function backupData() {
            alert('ãƒ‡ãƒ¼ã‚¿ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ©Ÿèƒ½ã¯é–‹ç™ºä¸­ã§ã™');
        }
        
        function logout() {
            if (confirm('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                localStorage.removeItem('isAuthenticated');
                localStorage.removeItem('lastLoginTime');
                window.location.href = 'pin_login.html';
            }
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            displayUserInfo();
            initializeStats();
        });

        // ç–‘ä¼¼ã‚¢ãƒ©ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ï¼ˆAPIé€£æºéƒ¨åˆ†ã¯å¾Œã§å®Ÿè£…ï¼‰
        let alerts = [
            { id: 1, time: '2024-06-20 10:12', site: 'ç¾å ´A', message: 'ã‚µãƒ¼ãƒãƒ¼å¿œç­”ãªã—', level: 'é«˜', status: 'æœªå¯¾å¿œ' },
            { id: 2, time: '2024-06-20 10:15', site: 'ç¾å ´B', message: 'ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡90%è¶…é', level: 'ä¸­', status: 'æœªå¯¾å¿œ' },
            { id: 3, time: '2024-06-20 10:20', site: 'ç¾å ´C', message: 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ–­', level: 'é«˜', status: 'æœªå¯¾å¿œ' }
        ];
        function renderAlerts() {
            const tbody = document.getElementById('alertTableBody');
            tbody.innerHTML = '';
            alerts.forEach(alert => {
                tbody.innerHTML += `<tr>
                    <td>${alert.time}</td>
                    <td>${alert.site}</td>
                    <td>${alert.message}</td>
                    <td>${alert.level}</td>
                    <td class="${alert.status==='æœªå¯¾å¿œ'?'status-unread':'status-read'}">${alert.status}</td>
                    <td><button class="btn" onclick="markAsRead(${alert.id})" ${alert.status==='å¯¾å¿œæ¸ˆã¿'?'disabled':''}>å¯¾å¿œæ¸ˆã¿ã«</button></td>
                </tr>`;
            });
        }
        function markAsRead(id) {
            alerts = alerts.map(a => a.id===id ? { ...a, status: 'å¯¾å¿œæ¸ˆã¿' } : a);
            renderAlerts();
        }
        // æ–°ç€ã‚¢ãƒ©ãƒ¼ãƒˆãƒãƒŠãƒ¼é€šçŸ¥ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰
        function showBanner(msg) {
            const banner = document.getElementById('alertBanner');
            banner.textContent = msg;
            banner.style.display = 'block';
            setTimeout(()=>{ banner.style.display = 'none'; }, 5000);
        }
        // ç–‘ä¼¼çš„ã«æ–°ç€ã‚¢ãƒ©ãƒ¼ãƒˆã‚’è¿½åŠ 
        setTimeout(()=>{
            alerts.unshift({ id: 4, time: '2024-06-20 10:30', site: 'ç¾å ´D', message: 'CPUä½¿ç”¨ç‡90%è¶…', level: 'é«˜', status: 'æœªå¯¾å¿œ' });
            renderAlerts();
            showBanner('æ–°ã—ã„ã‚¢ãƒ©ãƒ¼ãƒˆ: ç¾å ´D CPUä½¿ç”¨ç‡90%è¶…');
            // ãƒ–ãƒ©ã‚¦ã‚¶é€šçŸ¥
            if (Notification && Notification.permission === 'granted') {
                new Notification('æ–°ç€ã‚¢ãƒ©ãƒ¼ãƒˆ', { body: 'ç¾å ´D CPUä½¿ç”¨ç‡90%è¶…' });
            }
        }, 7000);
        // PWAç”¨ é€šçŸ¥è¨±å¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
        if (Notification && Notification.permission !== 'granted') {
            Notification.requestPermission();
        }
        renderAlerts();
    </script>
</body>
</html> 